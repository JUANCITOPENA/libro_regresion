[
["varcuali.html", "10 Modelos con variables cualitativas ¿Es posible incluir variables cualitativas? Variable indicadora, dummy, ficticia o binaria Creando variables indicadoras Modelos con variables cualitativas Significancia de variables cualitativas", " 10 Modelos con variables cualitativas En este capítulo se muestra cómo incluir variables cualitativas en un modelo de regresión con R. ¿Es posible incluir variables cualitativas? Una de las preguntas frecuentes entre los que inician el estudio de los modelos de regresión es: ¿se pueden incluir variables cualitativas en un modelo de regresión? La respuesta es SI, definitivamente si. A continuación una figura que ilustra algunas de las variables que se pueden incluir en la construcción de un modelo de regresión. Figure 10.1: Variables variables cualitativas a incluir en un modelo. Variable indicadora, dummy, ficticia o binaria La palabra indicadora, dummy, ficticia o binaria es la denominación genérica para una variable que toma valores de 0 o de 1 y que se utiliza para re-expresar variables cualitativas. Observe la figura 10.2. En la parte izquierda se tiene una base original de ejemplo con las variables precio, área y piscina, asociadas a seis apartamentos. La variable cualitativa Piscina de niveles sin, pequeña y grande, el nivel sin es el nivel de referencia natural. Al lado derecho de la figura 10.2 está la base transformada y vemos que hay 4 variables. Las nuevas variables PisPeq y PisGra son 2 variables indicadoras que logran resumir la información de la variable Piscina que tiene 3 variables. Para comprender como las 2 variables indicadoras pueden resumir la información de la variable Piscina, vamos a considerar los siguientes tres casos: Si PisPeq = 0 y PisGra = 0, entonces el apartamento está SIN piscina. Si PisPeq = 1 y PisGra = 0, entonces el apartamento tiene piscina PEQUEÑA. Si PisPeq = 0 y PisGra = 1, entonces el apartamento tiene piscina GRANDE. Figure 10.2: Transformando una base de datos con variables cualitativas. Como regla general, si una variable cualitativa tiene \\(k\\) niveles, se necesitarán de \\(k-1\\) variables indicadoras para resumir la variable cualitativa. Creando variables indicadoras Crear manualmente variables indicadoras para re-expresar variables cualitativas es una tarea muy sencilla, manualmente la podemos hacer. Sin embargo, R posee una herramienta que nos permite convertir la base de datos original en una base de datos transformada (con variables indicadoras). Para este fin se usa la función model.matrix. Ejemplo Retomando la base de datos original mostrada en la figura 10.2 vamos a crear la matriz de diseño \\(\\boldsymbol{X}\\) para ajustar el modelo siguiente: \\[\\begin{align} Precio_i &amp;\\sim N(\\mu_i, \\sigma^2), \\\\ \\mu_i &amp;= \\beta_0 + \\beta_1 Area_i + \\beta_2 PisciPequena_i + \\beta_3 PisiGrande_i, \\\\ \\sigma^2 &amp;= \\text{constante} \\end{align}\\] Lo primero a realizar es ingresar los datos para el ejemplo mostrado en la figura 10.2. El código necesario se muestra a continuación. Precio &lt;- c(12, 15, 25, 11, 16, 7) Area &lt;- c(3, 4, 1, 6, 5, 3) Pisci &lt;- factor(x=c(&#39;Grande&#39;, &#39;Sin&#39;, &#39;Pequena&#39;, &#39;Pequena&#39;, &#39;Sin&#39;, &#39;Grande&#39;), levels=c(&#39;Sin&#39;,&#39;Pequena&#39;,&#39;Grande&#39;)) Al crear el vector Pisci se usó el argumento levels dentro de la función factor para indicarle a R que el nivel de referencia es Sin, seguido de Pequena y luego Grande. Para obtener la matriz \\(\\boldsymbol{X}\\) con las variables indicadoras (no con la variable original Pisci) se hace lo siguiente: model.matrix(Precio ~ Area + Pisci) ## (Intercept) Area PisciPequena PisciGrande ## 1 1 3 0 1 ## 2 1 4 0 0 ## 3 1 1 1 0 ## 4 1 6 1 0 ## 5 1 5 0 0 ## 6 1 3 0 1 ## attr(,&quot;assign&quot;) ## [1] 0 1 2 2 ## attr(,&quot;contrasts&quot;) ## attr(,&quot;contrasts&quot;)$Pisci ## [1] &quot;contr.treatment&quot; Modelos con variables cualitativas Para ajustar un modelo de regresión lineal con variables cualitativas se procede de la forma usual como se ajustan modelos con lm, no es necesario crear de antemano la matriz \\(\\boldsymbol{X}\\), esto porque lm internamente crea la matriz de diseño \\(\\boldsymbol{X}\\). Ejemplo En este ejemplo vamos a utilizar la base de datos Cars93 del paquete MASS. El objetivo es ajustar el siguiente modelo para explicar el precio del auto en función del tamaño del motor y del tipo de auto, es decir, el objetivo es ajustar el siguiente modelo. \\[\\begin{align} Precio_i &amp;\\sim N(\\mu_i, \\sigma^2), \\\\ \\mu_i &amp;= \\beta_0 + \\beta_1 EngSize_i + \\beta_2 TypeC_i + \\beta_3 TypeS_i + \\beta_4 TypeM_i + \\beta_5 TypeL_i + \\beta_6 TypeV_i, \\\\ \\sigma^2 &amp;= \\text{constante} \\end{align}\\] Solución Lo primero a realizar es cargar el paquete y explorar las variables de interés con la ayuda de la función str. require(MASS) str(Cars93[, c(&#39;Price&#39;, &#39;EngineSize&#39;, &#39;Type&#39;)]) ## &#39;data.frame&#39;: 93 obs. of 3 variables: ## $ Price : num 15.9 33.9 29.1 37.7 30 15.7 20.8 23.7 26.3 34.7 ... ## $ EngineSize: num 1.8 3.2 2.8 2.8 3.5 2.2 3.8 5.7 3.8 4.9 ... ## $ Type : Factor w/ 6 levels &quot;Compact&quot;,&quot;Large&quot;,..: 4 3 1 3 3 3 2 2 3 2 ... La variable Type tiene 6 niveles, para ver todos niveles usamos el siguiente código. levels(Cars93$Type) ## [1] &quot;Compact&quot; &quot;Large&quot; &quot;Midsize&quot; &quot;Small&quot; &quot;Sporty&quot; &quot;Van&quot; De la salida anterior se observan que los niveles son Compact, Large, Midsize, Small, Sporty y Van. Al observar cuidadosamente los niveles vemos que ellos están ordenados por orden lexicográfico, primero Compact por iniciar con la letra C, por último Van por iniciar con la letra V. Al mirar el modelo requerido se nota que el nivel Small no aparece en la ecuación de \\(\\mu\\), esto significa que ese es el nivel de referencia que se encuentra en el intercepto \\(\\beta_0\\). Para redefinir los niveles en el orden requerido usamos el siguiente código. Cars93$Type &lt;- factor(Cars93$Type, levels=c(&#39;Small&#39;, &#39;Compact&#39;, &#39;Sporty&#39;, &#39;Midsize&#39;, &#39;Large&#39;, &#39;Van&#39;)) levels(Cars93$Type) # Para verificar el cambio ## [1] &quot;Small&quot; &quot;Compact&quot; &quot;Sporty&quot; &quot;Midsize&quot; &quot;Large&quot; &quot;Van&quot; A continuación vamos a crear un diagrama de dispersión para ver la relación entre las variables del problema. library(ggplot2) ggplot(Cars93, aes(x=EngineSize, y=Price, color=Type)) + geom_point() + theme_light() Ahora si podemos ajustar el modelo solicitado usando el siguiente código. mod &lt;- lm(Price ~ EngineSize + Type, data=Cars93) summary(mod) ## ## Call: ## lm(formula = Price ~ EngineSize + Type, data = Cars93) ## ## Residuals: ## Min 1Q Median 3Q Max ## -15.742 -4.568 -0.845 2.473 34.031 ## ## Coefficients: ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 2.794 2.348 1.190 0.23732 ## EngineSize 4.621 1.110 4.164 7.4e-05 *** ## TypeCompact 4.644 2.484 1.870 0.06489 . ## TypeSporty 5.078 2.634 1.928 0.05721 . ## TypeMidsize 10.286 2.700 3.810 0.00026 *** ## TypeLarge 2.053 3.916 0.524 0.60138 ## TypeVan 1.517 3.332 0.455 0.65006 ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Residual standard error: 7.068 on 86 degrees of freedom ## Multiple R-squared: 0.4995, Adjusted R-squared: 0.4646 ## F-statistic: 14.3 on 6 and 86 DF, p-value: 3.071e-11 Usando la información de la salida anterior se puede construir el siguiente modelo ajustado. \\[\\begin{align} \\widehat{Precio}_i &amp;\\sim N(\\hat{\\mu}_i, \\hat{\\sigma}^2), \\\\ \\hat{\\mu}_i &amp;= 2.794 + 4.621 EngSize_i + 4.644 TypeC_i + 5.078 TypeS_i + 10.286 TypeM_i + \\ldots \\\\ \\hat{\\sigma} &amp;= 7.068 \\end{align}\\] ¿Cómo se interpretan los coeficientes? Para cada tipo de auto, si el tamaño del motor se pudiera aumentar en 1 litro, se espera que el precio promedio aumente en 4.621 miles de dólares. Si tenemos dos autos, uno small y otro compacto, ambos con el mismo tamaño del motor, se espera que el precio promedio del compacto sea 4.644 miles de dólares mayor con respecto al auto small. Si comparamos un auto small y uno midsize, ambos con el mismo tamaño del motor, es de esperarse que el precio promedio del auto midsize sea 10.286 miles de dólares más que el small. Dos autos con el mismo tamaño del motos, uno de tipo sporty y otro de tipo large, se espera que el de tipo sporty tenga un precio promedio de 3.025 miles de dólares más que el large (valor obtenido de 5.078-2.053). Cuidado, no intente interpretar \\(\\hat{\\beta}_0\\) en este ejemplo. ¿Por qué? Significancia de variables cualitativas Cuando se incluye una variable cualitativa de \\(k\\) niveles en un modelo de regresión, aparecen \\(k-1\\) variables indicadoras y por lo tanto \\(k-1\\) valores-P en la tabla resumen. Una pregunta frecuente entre los usuarios es ¿cómo saber si una variable cualitativa es significativa para el modelo? Para saber si una variable cualitativa es significativa para un modelo hay tres formas: Mirar si el valor-P de cualquiera de las variables indicadoras es menor que en el nivel de significancia en el summary(mod). Crear una anova y ver si la variable cualitativa es significativa en el modelo es decir, usando anova(mod). Crear un modelo reducido sin la variable cualitativa y usar un análisis de varianza, anova(mod.redu, mod). Ejemplo En este ejemplo vamos a retomar los datos del ejemplo anterior en el cual se usa la base de datos Cars93 del paquete MASS. El objetivo es ajustar un modelo para explicar el precio del auto en función del tamaño del motor y del tipo de auto. ¿Será la variable tipo de auto significativa para el modelo? Para responder la pregunta anterior vamos a usar las tres formas listadas anteriormente. Primero vamos a ajustar el modelo de interés nuevamente. require(MASS) Cars93$Type &lt;- factor(Cars93$Type, levels=c(&#39;Small&#39;, &#39;Compact&#39;, &#39;Sporty&#39;, &#39;Midsize&#39;, &#39;Large&#39;, &#39;Van&#39;)) # Para usar Small como referencia mod &lt;- lm(Price ~ EngineSize + Type, data=Cars93) Forma 1 En la forma 1 debemos mirar si el valor-P de cualquiera de las variables indicadoras es menor que en el nivel de significancia en el summary(mod). Al mirar el resultado del summary(mod) se observa que el valor-P asociado a la variable TypeMidsize es menor que el valor usuar de significancia 5%, por lo tanto la variable Type es sifinificativa para el modelo. summary(mod) ## ## Call: ## lm(formula = Price ~ EngineSize + Type, data = Cars93) ## ## Residuals: ## Min 1Q Median 3Q Max ## -15.742 -4.568 -0.845 2.473 34.031 ## ## Coefficients: ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 2.794 2.348 1.190 0.23732 ## EngineSize 4.621 1.110 4.164 7.4e-05 *** ## TypeCompact 4.644 2.484 1.870 0.06489 . ## TypeSporty 5.078 2.634 1.928 0.05721 . ## TypeMidsize 10.286 2.700 3.810 0.00026 *** ## TypeLarge 2.053 3.916 0.524 0.60138 ## TypeVan 1.517 3.332 0.455 0.65006 ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Residual standard error: 7.068 on 86 degrees of freedom ## Multiple R-squared: 0.4995, Adjusted R-squared: 0.4646 ## F-statistic: 14.3 on 6 and 86 DF, p-value: 3.071e-11 Forma 2 En la forma 2 debemos crear una anova y ver si la variable cualitativa es significativa en el modelo es decir, usando anova(mod). Al usar la función anova sobre un modelo mod obtenido con la función lm, apareceran tantas filas (con valor-P) como número de variables tenga el modelo ajustado. El conjunto de hipótesis para cada una de las filas es: \\[\\begin{align} H_0 &amp;: \\text{la variable de la FILA no aporta información para el modelo}, \\\\ H_A &amp;: \\text{la variable de la FILA si aporta información para el modelo} \\end{align}\\] A continuación el código para usar la forma 2.. anova(mod) ## Analysis of Variance Table ## ## Response: Price ## Df Sum Sq Mean Sq F value Pr(&gt;F) ## EngineSize 1 3063.8 3063.78 61.3270 1.16e-11 *** ## Type 5 1223.8 244.77 4.8994 0.000542 *** ## Residuals 86 4296.4 49.96 ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 De la salida anterior se observa que el valor-P asociado a Type es de 0.000542, usando un nivel de significancia usual del 5% se concluye que hay evidencias para rechazar \\(H_0\\), es decir, la variable Type si aporta información al modelo. Forma 3 En la forma 3 debemos crear un modelo reducido sin la variable cualitativa y usar un análisis de varianza, anova(mod.redu, mod). Al usar la función anova el conjunto de hipótesis es: \\[\\begin{align} H_0 &amp;: \\text{la variable Type no aporta información para el modelo}, \\\\ H_A &amp;: \\text{la variable Type si aporta información para el modelo} \\end{align}\\] A continuación el código para usar la forma 3. El modelo mod.redu contiene un modelo sin la variable cualitativa de interés Type. mod.redu &lt;- lm(Price ~ EngineSize, data=Cars93) anova(mod.redu, mod) ## Analysis of Variance Table ## ## Model 1: Price ~ EngineSize ## Model 2: Price ~ EngineSize + Type ## Res.Df RSS Df Sum of Sq F Pr(&gt;F) ## 1 91 5520.2 ## 2 86 4296.4 5 1223.8 4.8994 0.000542 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 De la salida anterior se tiene un valor-P de 0.000542, usando un nivel de significancia usual del 5% se concluye que hay evidencias para rechazar \\(H_0\\), es decir, la variable Type si aporta información para el modelo y por lo tanto es una variable útil. La decisión final con las formas 1, 2 y 3 siempre coinciden. La forma 2 y la forma 3 no son la misma. Algunas veces una variable cualitativa puede ser significativa en el modelo pero los valores-P asociados a sus variables indicadoras (auxiliares) son todos mayores al valor \\(\\alpha\\), el resultado del summary puede ser engañoso. Para esto se recomienda usar la función anova. Por favor vea los ejemplos con variables cualitativas del capítulo 6. "]
]
